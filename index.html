<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì´ë¼333ë°° ê°œë§ì§± ì»¨í…ì¸ </title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: transparent; font-family: 'Noto Sans KR', sans-serif; padding: 10px; width: 900px; }
.panel { background: linear-gradient(160deg, #2a1a00 0%, #3d2600 40%, #2a1a00 100%); border-radius: 12px; border: 3px solid #c88a2a; box-shadow: 0 0 0 1px #6b4200, 0 0 30px rgba(200,138,42,0.3), inset 0 1px 0 rgba(255,220,100,0.15); overflow: hidden; position: relative; }
.panel::before { content: ''; position: absolute; inset: 0; background: repeating-linear-gradient(90deg, transparent, transparent 120px, rgba(0,0,0,0.04) 120px, rgba(0,0,0,0.04) 121px); pointer-events: none; z-index: 0; }
.header { position: relative; z-index: 1; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 8px 20px 6px; background: linear-gradient(90deg, transparent, rgba(255,190,50,0.08), transparent); border-bottom: 2px solid #6b4200; }
.header-title { font-size: 16px; font-weight: 900; color: #ffe680; text-shadow: 0 0 12px rgba(255,200,0,0.6), 2px 2px 0 rgba(0,0,0,0.6); letter-spacing: 2px; }
.header-glove { font-size: 16px; display: inline-block; animation: punch 0.6s ease infinite alternate; }
@keyframes punch { from { transform: scale(1) rotate(-15deg); } to { transform: scale(1.2) rotate(10deg); } }

/* íˆë“  í† ê¸€ ë²„íŠ¼ */
.hidden-controls { position: relative; z-index: 10; display: flex; justify-content: center; padding: 4px 10px; gap: 8px; border-bottom: 1px solid rgba(107,66,0,0.4); }
.toggle-btn { background: rgba(0,0,0,0.5); border: 1px solid #6b4200; border-radius: 6px; color: #c88a2a; font-size: 11px; font-weight: 700; padding: 3px 12px; cursor: pointer; letter-spacing: 0.5px; transition: all 0.2s; font-family: 'Noto Sans KR', sans-serif; }
.toggle-btn:hover { background: rgba(200,138,42,0.2); border-color: #c88a2a; color: #ffe680; }
.toggle-btn.revealed { background: rgba(200,50,50,0.3); border-color: #ff6060; color: #ffaaaa; }

.round-summary { position: relative; z-index: 1; display: flex; gap: 6px; padding: 6px 14px; border-bottom: 1px solid rgba(107,66,0,0.6); }
.round-badge { flex: 1; background: rgba(0,0,0,0.3); border: 1px solid #6b4200; border-radius: 8px; padding: 4px 8px; text-align: center; }
.round-badge.hidden-badge { filter: blur(5px); pointer-events: none; user-select: none; transition: filter 0.6s ease; }
.round-badge.revealed-badge { filter: none; }
.round-badge .r-label { font-size: 10px; color: #c88a2a; font-weight: 700; letter-spacing: 1px; }
.round-badge .r-winner { font-size: 12px; color: #ffe680; font-weight: 700; margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.race-section { position: relative; z-index: 1; padding: 8px 14px; }
.race-row { margin-bottom: 6px; animation: fadeSlide 0.5s ease both; }
.race-row:nth-child(1) { animation-delay: 0.0s; }
.race-row:nth-child(2) { animation-delay: 0.07s; }
.race-row:nth-child(3) { animation-delay: 0.14s; }
.race-row:nth-child(4) { animation-delay: 0.21s; }
.race-row:nth-child(5) { animation-delay: 0.28s; }
.race-row:nth-child(6) { animation-delay: 0.35s; }
.race-row:nth-child(7) { animation-delay: 0.42s; }
@keyframes fadeSlide { from { opacity:0; transform: translateX(-20px); } to { opacity:1; transform: translateX(0); } }

.race-top { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
.rank-badge { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 900; flex-shrink: 0; border: 2px solid; }
.rank-1 { background: radial-gradient(circle, #ffe047, #c87000); color: #3a1a00; border-color: #ffcc00; box-shadow: 0 0 10px rgba(255,200,0,0.6); }
.rank-2 { background: radial-gradient(circle, #d0d8e0, #7a8a99); color: #1a2030; border-color: #b0bec5; }
.rank-3 { background: radial-gradient(circle, #f0a070, #a04010); color: #2a0800; border-color: #cd7f32; }
.rank-other { background: rgba(0,0,0,0.4); color: #a09060; border-color: #5a4020; }

.avatar-wrap { width: 38px; height: 38px; flex-shrink: 0; }
.avatar-wrap img { width: 38px; height: 38px; object-fit: cover; border-radius: 6px; border: 2px solid; display: block; }
.rank-1-border { border-color: #ffcc00 !important; box-shadow: 0 0 6px rgba(255,200,0,0.7); }
.rank-2-border { border-color: #b0bec5 !important; }
.rank-3-border { border-color: #cd7f32 !important; }
.rank-o-border { border-color: #5a4020 !important; }
.avatar-placeholder { width: 38px; height: 38px; border-radius: 6px; background: rgba(0,0,0,0.3); border: 2px dashed #6b4200; display: flex; align-items: center; justify-content: center; font-size: 18px; }

.name-score { flex: 1; min-width: 0; }
.streamer-name { font-size: 12px; font-weight: 700; color: #ffe680; text-shadow: 1px 1px 0 rgba(0,0,0,0.7); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.score-total { font-size: 16px; font-weight: 900; color: #fff; text-shadow: 0 0 8px rgba(255,200,0,0.4), 1px 1px 0 rgba(0,0,0,0.8); letter-spacing: -0.5px; }
.score-label { font-size: 10px; color: #c88a2a; margin-left: 2px; }

.round-scores { display: flex; gap: 3px; margin-left: auto; flex-shrink: 0; }
.rs-badge { background: rgba(0,0,0,0.4); border: 1px solid #5a4020; border-radius: 4px; padding: 2px 5px; text-align: center; min-width: 36px; }
.rs-badge .rs-r { font-size: 8px; color: #a07840; font-weight: 700; }
.rs-badge .rs-v { font-size: 11px; color: #e8d080; font-weight: 700; }
.rs-badge.hidden-score { filter: blur(4px); transition: filter 0.6s ease; }
.rs-badge.revealed-score { filter: none; }

/* íŠ¸ë™ - ë‹¬ë¦¬ê¸° ìºë¦­í„° 3ë°° (90â†’270px), íŠ¸ë™ ë†’ì´ë„ ì¶©ë¶„íˆ */
.track-wrap { position: relative; height: 60px; }
.track-bg { position: absolute; top: 50%; transform: translateY(-50%); left: 135px; right: 0; height: 14px; background: #1a1008; border-radius: 6px; border: 1px solid #4a3010; overflow: hidden; }
.track-bg::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); left: 0; right: 0; height: 2px; background: repeating-linear-gradient(90deg, transparent, transparent 12px, rgba(255,200,0,0.15) 12px, rgba(255,200,0,0.15) 22px); }
.track-fill { position: absolute; top: 0; left: 0; height: 100%; border-radius: 6px; transition: width 1s cubic-bezier(0.34,1.3,0.64,1); z-index: 1; }
.fill-1 { background: linear-gradient(90deg, #c87000, #ffcc00, #ffe680); box-shadow: 0 0 6px rgba(255,180,0,0.6); }
.fill-2 { background: linear-gradient(90deg, #5a6a7a, #b0bec5); }
.fill-3 { background: linear-gradient(90deg, #7a3010, #cd7f32); }
.fill-o { background: linear-gradient(90deg, #3a2800, #6b4200); }
.finish-line { position: absolute; right: 0; top: 0; height: 100%; width: 10px; background: repeating-linear-gradient(90deg, #fff 0px, #fff 3px, #000 3px, #000 6px); border-radius: 0 6px 6px 0; opacity: 0.6; z-index: 2; }

/* ë‹¬ë¦¬ê¸° ìºë¦­í„° 3ë°° í¬ê¸°: 270px */
.runner-icon { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 270px; height: 270px; z-index: 3; transition: left 1s cubic-bezier(0.34,1.3,0.64,1); }
.runner-icon img { width: 270px; height: 270px; object-fit: cover; border-radius: 4px; border: 2px solid rgba(255,200,0,0.5); image-rendering: pixelated; }
.runner-placeholder { width: 270px; height: 270px; border-radius: 4px; background: rgba(200,138,42,0.3); border: 1px solid #c88a2a; display: flex; align-items: center; justify-content: center; font-size: 60px; }
.runner-icon.is-first::after { content: 'â­'; position: absolute; top: -14px; left: 50%; transform: translateX(-50%); font-size: 12px; animation: bounce 0.8s ease infinite alternate; }
@keyframes bounce { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-4px); } }

.divider { height: 1px; background: linear-gradient(90deg, transparent, #6b4200, transparent); margin: 0 14px; position: relative; z-index: 1; }
.footer { position: relative; z-index: 1; display: flex; align-items: center; justify-content: flex-end; padding: 4px 14px 6px; gap: 6px; }
.live-dot { width: 7px; height: 7px; border-radius: 50%; background: #4cff80; box-shadow: 0 0 6px rgba(76,255,128,0.8); animation: pulse 1.5s ease infinite; }
@keyframes pulse { 0%,100% { opacity:1; transform:scale(1); } 50% { opacity:0.5; transform:scale(0.8); } }
.live-text { font-size: 11px; color: #4cff80; font-weight: 700; letter-spacing: 1px; }
.update-time { font-size: 10px; color: #6b5030; margin-left: 6px; }
.empty { padding: 30px; text-align: center; color: #6b4200; font-size: 14px; position: relative; z-index: 1; }
</style>
</head>
<body>
<div class="panel" id="panel">
  <div class="header">
    <span class="header-glove">ğŸ¥Š</span>
    <span class="header-title">ì´ë¼333ë°° ê°œë§ì§± ì»¨í…ì¸ </span>
    <span class="header-glove">ğŸ¥Š</span>
  </div>

  <!-- 3ë¼ìš´ë“œ íˆë“  í† ê¸€ ë²„íŠ¼ -->
  <div class="hidden-controls">
    <button class="toggle-btn" id="toggleBtn" onclick="toggleRound3()">ğŸ”’ 3ë¼ìš´ë“œ ê³µê°œ</button>
  </div>

  <div class="round-summary" id="roundSummary" style="display:none">
    <div class="round-badge"><div class="r-label">ğŸ¥Š 1ë¼ìš´ë“œ</div><div class="r-winner" id="r1winner">-</div></div>
    <div class="round-badge"><div class="r-label">ğŸ¥Š 2ë¼ìš´ë“œ</div><div class="r-winner" id="r2winner">-</div></div>
    <div class="round-badge hidden-badge" id="r3badge"><div class="r-label">ğŸ¥Š 3ë¼ìš´ë“œ</div><div class="r-winner" id="r3winner">-</div></div>
  </div>

  <div class="race-section" id="raceSection">
    <div class="empty">ğŸ“¡ ë°ì´í„° ë¡œë”© ì¤‘...</div>
  </div>
  <div class="divider"></div>
  <div class="footer">
    <div class="live-dot"></div>
    <span class="live-text">LIVE</span>
    <span class="update-time" id="updateTime">-</span>
  </div>
</div>
<script>
const SHEET_ID   = "18F2mJsiSWYbxSl97u4vKEX9pTuEOuoL1WaGE5PB_iJ0";
const SHEET_NAME = "ì‹œíŠ¸1!E11:I17"; // 7ëª…ìœ¼ë¡œ í™•ì¥
let prevJSON = "";
let round3Revealed = false;

function toggleRound3() {
  round3Revealed = !round3Revealed;
  const btn = document.getElementById("toggleBtn");
  const badge = document.getElementById("r3badge");

  if (round3Revealed) {
    btn.textContent = "ğŸ”“ 3ë¼ìš´ë“œ ìˆ¨ê¸°ê¸°";
    btn.classList.add("revealed");
    badge.classList.remove("hidden-badge");
    badge.classList.add("revealed-badge");
    document.querySelectorAll(".rs-badge-r3").forEach(el => {
      el.classList.remove("hidden-score");
      el.classList.add("revealed-score");
    });
  } else {
    btn.textContent = "ğŸ”’ 3ë¼ìš´ë“œ ê³µê°œ";
    btn.classList.remove("revealed");
    badge.classList.add("hidden-badge");
    badge.classList.remove("revealed-badge");
    document.querySelectorAll(".rs-badge-r3").forEach(el => {
      el.classList.add("hidden-score");
      el.classList.remove("revealed-score");
    });
  }
}

function getImgFile(name, rank) {
  if (name === "ì´ë¼333") {
    return rank <= 3 ? "/images/default.gif" : "/images/ì´ë¼333.gif";
  }
  return "/images/default.gif";
}

function getRoundWinner(data, key) {
  if (!data.length) return "-";
  return data.reduce((best, r) =>
    Number(r[key]) > Number(best[key]) ? r : best
  )["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "-";
}

function render(data) {
  if (!data || !data.length) {
    document.getElementById("raceSection").innerHTML = "<div class='empty'>ğŸ˜¶ ë°ì´í„° ì—†ìŒ</div>";
    document.getElementById("roundSummary").style.display = "none";
    return;
  }

  data.sort((a, b) => Number(b["ğŸ“ìµœì¢… ì ìˆ˜"]) - Number(a["ğŸ“ìµœì¢… ì ìˆ˜"]));

  // 7ëª…ìœ¼ë¡œ ì œí•œ
  data = data.slice(0, 7);

  const json = JSON.stringify(data);
  if (json === prevJSON) return;
  prevJSON = json;

  const maxScore = Math.max(...data.map(r => Number(r["ğŸ“ìµœì¢… ì ìˆ˜"]) || 0));

  document.getElementById("roundSummary").style.display = "flex";
  document.getElementById("r1winner").textContent = getRoundWinner(data, "ğŸ¥Š1ì„¸íŠ¸");
  document.getElementById("r2winner").textContent = getRoundWinner(data, "ğŸ¥Š2ì„¸íŠ¸");
  document.getElementById("r3winner").textContent = getRoundWinner(data, "ğŸ¥Š3ì„¸íŠ¸");

  const section = document.getElementById("raceSection");
  section.innerHTML = "";

  const rankFillClass   = ["fill-1","fill-2","fill-3","fill-o","fill-o","fill-o","fill-o"];
  const rankBadgeClass  = ["rank-1","rank-2","rank-3","rank-other","rank-other","rank-other","rank-other"];
  const rankBorderClass = ["rank-1-border","rank-2-border","rank-3-border","rank-o-border","rank-o-border","rank-o-border","rank-o-border"];

  data.forEach((row, i) => {
    const rank  = i + 1;
    const name  = row["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "?";
    const total = Number(row["ğŸ“ìµœì¢… ì ìˆ˜"]) || 0;
    const s1    = row["ğŸ¥Š1ì„¸íŠ¸"] || "-";
    const s2    = row["ğŸ¥Š2ì„¸íŠ¸"] || "-";
    const s3    = row["ğŸ¥Š3ì„¸íŠ¸"] || "-";
    // íŠ¸ë™ ì‹œì‘ì´ 135px ì˜¤í”„ì…‹ì´ë¯€ë¡œ í¼ì„¼íŠ¸ ê³„ì‚° ìœ ì§€
    const pct   = maxScore > 0 ? Math.min(96, Math.max(4, (total / maxScore) * 92)) : 4;
    const imgFile = getImgFile(name, rank);

    // 3ë¼ìš´ë“œ íˆë“  í´ë˜ìŠ¤
    const r3HiddenClass = round3Revealed ? "revealed-score" : "hidden-score";

    const div = document.createElement("div");
    div.className = "race-row";
    div.innerHTML =
      '<div class="race-top">' +
        '<div class="rank-badge ' + rankBadgeClass[i] + '">' + rank + '</div>' +
        '<div class="avatar-wrap">' +
          '<img src="' + imgFile + '" class="' + rankBorderClass[i] + '" onerror="this.outerHTML=\'<div class=&quot;avatar-placeholder&quot;>ğŸ§™</div>\'" alt="' + name + '">' +
        '</div>' +
        '<div class="name-score">' +
          '<div class="streamer-name">' + name + '</div>' +
          '<div><span class="score-total">' + total.toLocaleString() + '</span><span class="score-label">pt</span></div>' +
        '</div>' +
        '<div class="round-scores">' +
          '<div class="rs-badge"><div class="rs-r">1ë¼ìš´ë“œ</div><div class="rs-v">' + s1 + '</div></div>' +
          '<div class="rs-badge"><div class="rs-r">2ë¼ìš´ë“œ</div><div class="rs-v">' + s2 + '</div></div>' +
          '<div class="rs-badge rs-badge-r3 ' + r3HiddenClass + '"><div class="rs-r">3ë¼ìš´ë“œ</div><div class="rs-v">' + s3 + '</div></div>' +
        '</div>' +
      '</div>' +
      '<div class="track-wrap">' +
        '<div class="track-bg">' +
          '<div class="track-fill ' + rankFillClass[i] + '" style="width:' + pct + '%"></div>' +
          '<div class="finish-line"></div>' +
        '</div>' +
        '<div class="runner-icon' + (rank === 1 ? ' is-first' : '') + '" style="left:calc(135px + ' + pct + '% * (100% - 135px) / 100)">' +
          '<img src="' + imgFile + '" onerror="this.outerHTML=\'<div class=&quot;runner-placeholder&quot;>ğŸƒ</div>\'" alt="' + name + '">' +
        '</div>' +
      '</div>';
    section.appendChild(div);
  });

  const now = new Date();
  document.getElementById("updateTime").textContent =
    "ì—…ë°ì´íŠ¸ " + String(now.getHours()).padStart(2,"0") + ":" +
    String(now.getMinutes()).padStart(2,"0") + ":" +
    String(now.getSeconds()).padStart(2,"0");
}

async function fetchData() {
  const url = "https://opensheet.elk.sh/" + SHEET_ID + "/" + encodeURIComponent(SHEET_NAME);
  try {
    const res  = await fetch(url);
    const data = await res.json();
    render(data);
  } catch (e) {
    console.error(e);
    document.getElementById("raceSection").innerHTML = "<div class='empty'>ğŸ˜¢ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>";
  }
}

fetchData();
setInterval(fetchData, 5000);
</script>
</body>
</html>















